<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-200">

    <!-- Giao diện đăng nhập -->
    <div id="loginScreen" class="bg-white p-6 rounded-lg shadow-lg w-96">
        <h2 class="text-2xl font-bold text-center mb-4">Login</h2>
        <input id="username" type="text" placeholder="Username" class="w-full p-2 border rounded mb-2">
        <input id="password" type="password" placeholder="Password" class="w-full p-2 border rounded mb-2">
        <button id="loginBtn" class="w-full bg-blue-500 text-white py-2 rounded">Login</button>
        <p id="errorText" class="text-red-500 text-sm mt-2 hidden">Sai tên đăng nhập hoặc mật khẩu!</p>
    </div>

    <!-- Giao diện chat -->
    <div id="chatScreen" class="hidden w-full h-dvh bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-bold text-center mb-4">Chat Room</h2>
        <div id="messages" class="h-[calc(100%-200px)] overflow-y-auto border p-3 rounded bg-gray-100"></div>
        <input id="messageInput" type="text" placeholder="Nhập tin nhắn..." class="w-full p-2 border rounded mt-3">
        <button id="sendBtn" class="w-full bg-green-500 text-white py-2 rounded mt-2">Gửi</button>
    </div>

    <script>
        const socket = io();
        let username = "";

        document.getElementById("loginBtn").addEventListener("click", async () => {
            const user = document.getElementById("username").value;
            const pass = document.getElementById("password").value;

            const response = await fetch("/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username: user, password: pass })
            });

            const data = await response.json();
            if (data.success) {
                username = data.username;
                document.getElementById("loginScreen").classList.add("hidden");
                document.getElementById("chatScreen").classList.remove("hidden");
                socket.emit("userJoined", username);
            } else {
                document.getElementById("errorText").classList.remove("hidden");
            }
        });

        document.getElementById("sendBtn").addEventListener("click", () => {
            const message = document.getElementById("messageInput").value;
            if (message.trim() !== "") {
                socket.emit("sendMessage", { username, text: message });
                document.getElementById("messageInput").value = "";
            }
        });

        socket.on("receiveMessage", (data) => {
            const msgContainer = document.getElementById("messages");
            msgContainer.innerHTML += `<p><strong>${data.username}:</strong> ${data.text}</p>`;
            msgContainer.scrollTop = msgContainer.scrollHeight;
        });
    </script>

</body>
</html>
